<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installing KK-Cryptoservice on cloud &mdash; Kripta Key Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b20cc3f5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=03d93ebb"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Miscellaneous operations" href="misc-actions.html" />
    <link rel="prev" title="Before installing on cloud" href="before-installing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Kripta Key Documentation
          </a>
              <div class="version">
                24.1.0015-RC-UP02
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../revision-history.html">Revision History</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kripta-key-primer.html">Kripta Key Primer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation-guide/index.html">Installation Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../clikk-installation-guide/index.html">CLIKK Installation Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Cloud Installation Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#preface">Preface</a></li>
<li class="toctree-l2"><a class="reference internal" href="before-installing.html">Before installing on cloud</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installing KK-Cryptoservice on cloud</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-ecs-instance">Accessing the ECS instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-selinux">Enabling SELinux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-vpn-between-kripta-key-instances">Setting up VPN between Kripta Key instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-kk-cryptoservice-dependencies">Setting up KK-Cryptoservice dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-kk-cryptoservice">Installing KK-Cryptoservice</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registering-the-kk-cryptoservice-instance">Registering the KK-Cryptoservice instance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="misc-actions.html">Miscellaneous operations</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kkts-guide/index.html">KK-TS Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tdp-installation-guide/index.html">TDP Installation Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license-guide/index.html">License Application Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sys-admin-guide/index.html">System Administrator Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev-guide/index.html">Developer Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../e2ee-dev-guide/index.html">E2EE Developer Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../func-module-guide/index.html">Functional Module Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../app-integration-guide/index.html">App Integration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../keycloak-integration-guide/index.html">KeyCloak Integration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sdk-api-docs/index.html">SDK API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rest-api-docs/index.html">REST API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../whitepaper/index.html">Whitepaper</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kripta Key Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Cloud Installation Guide</a></li>
      <li class="breadcrumb-item active">Installing KK-Cryptoservice on cloud</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cloud-installation-guide/cloud-installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installing-kk-cryptoservice-on-cloud">
<h1>Installing KK-Cryptoservice on cloud<a class="headerlink" href="#installing-kk-cryptoservice-on-cloud" title="Link to this heading"></a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Before running the installer, perform <a class="reference internal" href="../appendix.html#performing-integrity-checks"><span class="std std-ref">an integrity check</span></a> first.
Also, make sure that the installer is appropriate for the machine’s OS.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If errors were encountered during installation, details will be logged to <code class="docutils literal notranslate"><span class="pre">/var/log/kriptakey</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please contact <a class="reference external" href="mailto:support&#37;&#52;&#48;klaviskripta&#46;com">support<span>&#64;</span>klaviskripta<span>&#46;</span>com</a> if any problems were encountered during installation.</p>
</div>
<section id="accessing-the-ecs-instance">
<h2>Accessing the ECS instance<a class="headerlink" href="#accessing-the-ecs-instance" title="Link to this heading"></a></h2>
<p>First, the administrator must access the ECS instance and upload the KK-Cryptoservice installer via SSH.
Have the SSH key file ready (<code class="docutils literal notranslate"><span class="pre">kk-keypair.pem</span></code>), and get the instance’s public IP address
from the ECS Instance page. This example assumes that the instance’s public IP address is <code class="docutils literal notranslate"><span class="pre">149.129.213.7</span></code> —
replace this value with your instance’s public IP address.</p>
<ol class="arabic">
<li><p>Set the key file’s permission, or SSH will refuse to use the key file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>kk-keypair.pem
</pre></div>
</div>
</li>
<li><p>Upload the KK-Cryptoservice installer and its dependencies.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scp<span class="w"> </span>-i<span class="w"> </span>kk-keypair.pem<span class="w"> </span>kk-cs-2.0-0000.el8.x86_64.rpm<span class="w"> </span>sgx_rpm_local_repo.tgz<span class="w"> </span>root@149.129.213.7:/root/
</pre></div>
</div>
</li>
<li><p>Log in to the ECS instance with the key file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh<span class="w"> </span>-i<span class="w"> </span>kk-keypair.pem<span class="w"> </span>root@149.129.213.7
</pre></div>
</div>
</li>
</ol>
</section>
<section id="enabling-selinux">
<h2>Enabling SELinux<a class="headerlink" href="#enabling-selinux" title="Link to this heading"></a></h2>
<p>Security-Enhanced Linux (SELinux) is a security architecture for Linux systems that allows administrators
to have more control over who can access the system. SELinux defines access controls for the applications,
processes, and files on a system. It uses security policies, which are a set of rules that tell SELinux
what can or can’t be accessed, to enforce the access allowed by a policy.</p>
<p>Kripta Key leverages SELinux to add another layer of security to the files stored on the system.</p>
<ol class="arabic">
<li><p>Run command below on the ECS instance to modify the config file of SELinux.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/selinux/config
</pre></div>
</div>
</li>
<li><p>Find the line <code class="docutils literal notranslate"><span class="pre">SELINUX=disabled</span></code>, press the <code class="docutils literal notranslate"><span class="pre">i</span></code> key to enter edit mode, and then modify this line
to <code class="docutils literal notranslate"><span class="pre">SELINUX=enforcing</span></code>. The configuration file should be similar to this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file controls the state of SELinux on the system.</span>
<span class="c1"># SELINUX= can take one of these three values:</span>
<span class="c1">#     enforcing - SELinux security policy is enforced.</span>
<span class="c1">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="c1">#     disabled - No SELinux policy is loaded.</span>
<span class="na">SELINUX</span><span class="o">=</span><span class="s">enforcing</span>
<span class="c1"># SELINUXTYPE= can take one of these three values:</span>
<span class="c1">#     targeted - Targeted processes are protected,</span>
<span class="c1">#     minimum - Modification of targeted policy. Only selected processes are protected.</span>
<span class="c1">#     mls - Multi Level Security protection.</span>
<span class="na">SELINUXTYPE</span><span class="o">=</span><span class="s">targeted</span>
</pre></div>
</div>
</li>
<li><p>Create a file named <code class="docutils literal notranslate"><span class="pre">.autorelabel</span></code> file in the root directory, and ensure the file is successfully created.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>touch<span class="w"> </span>/.autorelabel
<span class="gp">$ </span>ll<span class="w"> </span>/.autorelabel

<span class="go">-rw-r--r-- 1 root root 0 Jul 24 15:18 /.autorelabel</span>
</pre></div>
</div>
</li>
<li><p>Restart the ECS instance. After the instance is restarted, SELinux will automatically relabel all system files.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>shutdown<span class="w"> </span>-r<span class="w"> </span>now
</pre></div>
</div>
</li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">getenforce</span></code> and <code class="docutils literal notranslate"><span class="pre">sestatus</span></code> to check if the SELinux is enabled and the current mode is <code class="docutils literal notranslate"><span class="pre">enforcing</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>getenforce
<span class="gp">$ </span>sestatus

<span class="go">SELinux status:                 enabled</span>
<span class="go">SELinuxfs mount:                /sys/fs/selinux</span>
<span class="go">SELinux root directory:         /etc/selinux</span>
<span class="go">Loaded policy name:             targeted</span>
<span class="go">Current mode:                   enforcing</span>
<span class="go">Mode from config file:          enforcing</span>
<span class="go">Policy MLS status:              enabled</span>
<span class="go">Policy deny_unknown status:     allowed</span>
<span class="go">Memory protection checking:     actual (secure)</span>
<span class="go">Max kernel policy version:      33</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="setting-up-vpn-between-kripta-key-instances">
<h2>Setting up VPN between Kripta Key instances<a class="headerlink" href="#setting-up-vpn-between-kripta-key-instances" title="Link to this heading"></a></h2>
<p>In order to set up VPN on the ECS instance, the SSL client certificate obtained in the configuration step
(<code class="docutils literal notranslate"><span class="pre">certs.zip</span></code>) must be uploaded to the ECS instance. Follow these steps to upload the certificate and set up VPN
on the ECS instance.</p>
<ol class="arabic">
<li><p>Upload the VPN SSL client certificate archive to the ECS instance.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>scp<span class="w"> </span>-i<span class="w"> </span>kk-keypair.pem<span class="w"> </span>certs.zip<span class="w"> </span>root@149.129.213.7:/root/
</pre></div>
</div>
</li>
<li><p>Upgrade the <code class="docutils literal notranslate"><span class="pre">epel-release</span></code> package.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>rpm<span class="w"> </span>-Uvh<span class="w"> </span>https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
</pre></div>
</div>
</li>
<li><p>Install the <code class="docutils literal notranslate"><span class="pre">epel-release</span></code> package.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>epel-release
</pre></div>
</div>
</li>
<li><p>Install the OpenVPN client and the unzip package.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>openvpn
<span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>unzip
</pre></div>
</div>
</li>
<li><p>Extract the certificate archive, and then run the OpenVPN client daemon using the configuration.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>unzip<span class="w"> </span>certs.zip
<span class="gp">$ </span>sudo<span class="w"> </span>openvpn<span class="w"> </span>--config<span class="w"> </span>config.ovpn<span class="w"> </span>--daemon
</pre></div>
</div>
</li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> to check if the VPN tunnel has been created successfully.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifconfig

<span class="go">tun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500</span>
<span class="go">inet 192.168.0.6  netmask 255.255.255.255  destination 192.168.0.5</span>
<span class="go">inet6 fe80::1c70:bb56:9e37:16a8  prefixlen 64  scopeid 0x20&lt;link&gt;</span>
<span class="go">unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 100  (UNSPEC)</span>
<span class="go">RX packets 0  bytes 0 (0.0 B)</span>
<span class="go">RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">TX packets 12  bytes 734 (734.0 B)</span>
<span class="go">TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
</pre></div>
</div>
<p>The IP address after <code class="docutils literal notranslate"><span class="pre">inet</span></code> is the KK-Cryptoservice instance’s host. Use this IP address
when registering the KK-Cryptoservice instance.</p>
</li>
<li><p>Repeat steps 3 to 6 on the KK-Manager instance’s machine. Ensure that the VPN tunnel
has been created successfully.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifconfig

<span class="go">tun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500</span>
<span class="go">inet 192.168.0.10  netmask 255.255.255.255  destination 192.168.0.9</span>
<span class="go">inet6 fe80::1c70:bb56:9e37:16a8  prefixlen 64  scopeid 0x20&lt;link&gt;</span>
<span class="go">unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 100  (UNSPEC)</span>
<span class="go">RX packets 0  bytes 0 (0.0 B)</span>
<span class="go">RX errors 0  dropped 0  overruns 0  frame 0</span>
<span class="go">TX packets 12  bytes 734 (734.0 B)</span>
<span class="go">TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span>
</pre></div>
</div>
<p>The IP address after <code class="docutils literal notranslate"><span class="pre">inet</span></code> is the KK-Manager instance’s host. Use this IP address as the KK-Manager
host address in the KK-Cryptoservice configuration file.</p>
</li>
</ol>
</section>
<section id="setting-up-kk-cryptoservice-dependencies">
<h2>Setting up KK-Cryptoservice dependencies<a class="headerlink" href="#setting-up-kk-cryptoservice-dependencies" title="Link to this heading"></a></h2>
<p>Before proceeding with KK-Cryptoservice’s installation, its dependencies must be installed first. Hence,
this step may be skipped if the dependencies have already been installed.</p>
<p>The administrator must download <a class="reference external" href="https://download.01.org/intel-sgx/sgx-linux/2.23/distro/rhel9.2-server/sgx_rpm_local_repo.tgz">Intel SGX Platform Software</a> and upload the <code class="docutils literal notranslate"><span class="pre">sgx_rpm_local_repo.tgz</span></code> archive
to the ECS instance. Then, follow these steps:</p>
<ol class="arabic">
<li><p>Extract the packages.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tar<span class="w"> </span>-xvf<span class="w"> </span>sgx_rpm_local_repo.tgz
</pre></div>
</div>
</li>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">sgx_rpm_local_repo</span></code> directory, and enable the repository.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>sgx_rpm_local_repo
<span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--add-repo<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>

<span class="go">Updating Subscription Management repositories.</span>
<span class="go">Adding repo from: file:///home/user/sgx_rpm_local_repo</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="installing-kk-cryptoservice">
<h2>Installing KK-Cryptoservice<a class="headerlink" href="#installing-kk-cryptoservice" title="Link to this heading"></a></h2>
<p>Once everything is all set, the administrator may begin installation of KK-Cryptoservice on the ECS instance.</p>
<ol class="arabic">
<li><p>Install KK-Cryptoservice from the RPM package. Note that KK-Cryptoservice depends on the packages
in <code class="docutils literal notranslate"><span class="pre">sgx_rpm_local_repo</span></code>. However, these packages are not signed with GPG. Hence, it must be installed
without performing the GPG check.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>--nogpgcheck<span class="w"> </span>install<span class="w"> </span>kk-cs-2.0-0000.el8.x86_64.rpm
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The installer automatically creates the user <code class="docutils literal notranslate"><span class="pre">kripta</span></code>.</p></li>
<li><p>The user <code class="docutils literal notranslate"><span class="pre">kripta</span></code> can only read files from the working directory.</p></li>
<li><p>The administrator, using their usual user account, <strong>cannot</strong> write directly to the working directory.
Files must be moved as the user <code class="docutils literal notranslate"><span class="pre">kripta</span></code> to the working directory.</p></li>
<li><p>During the installation process, the location of the working directory must be specified.
It is highly recommended to use the default value.</p></li>
</ul>
</div>
</li>
<li><p>After successfully installing KK-Cryptoservice, it must be configured by running its configuration script.
This will configure settings such as port, log level, SNMP server, and so on. Do note the following
when running the configuration script:</p>
<ul class="simple">
<li><p>Make sure to use the host IP address obtained while setting up the VPN.</p></li>
<li><p>The port may be any port from 1024 to 49151, inclusive.</p></li>
<li><p>Configuring the SNMP server is optional — errors are still recorded to the log file. However, it is
strongly recommended to configure the SNMP server so that critical alerts from Kripta Key can be
noticed promptly. To configure the SNMP server, the administrator must prepare the SNMP host and port,
SNMP username, SNMP authentication passphrase, and SNMP privacy passphrase.</p></li>
<li><p>For some configuration fields, the script will set a default value if value is omitted when prompted.</p></li>
<li><p>The working directory must be writable by the <code class="docutils literal notranslate"><span class="pre">kripta</span></code> user. For this reason, it is recommended
to use the default value, <code class="docutils literal notranslate"><span class="pre">/var/local/kriptakey/kk-cryptoservice</span></code>.</p></li>
</ul>
<p>Execute this command to set or change the KK-Cryptoservice instance’s configuration.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Sample output if SNMP server has not been configured.</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>/opt/kriptakey/kk-cryptoservice/kk-cs.sh

<span class="go">KK-Manager instance host address []: 192.168.0.10</span>
<span class="go">KK-Manager instance port []: 8086</span>
<span class="go">KK-Cryptoservice port for REST API endpoint [7003]: 8087</span>
<span class="go">KK-Cryptoservice port for SDK API endpoint [7004]: 8088</span>
<span class="go">SNMP server host and port in xxx.xxx.xxx.xxx:xxxx format []:</span>
<span class="go">WARNING: SNMP server address is empty. KK-Cryptoservice will not send SNMP alerts.</span>
<span class="go">KK-Cryptoservice log level (Option: ERROR/INFO/DEBUG) [ERROR]: ERROR</span>
<span class="go">KK-Cryptoservice working directory path [/var/local/kriptakey/kk-cryptoservice]: /var/local/kriptakey/kk-cryptoservice</span>

<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/db from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/sgxdata from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /etc/kriptakey/kk-csd.conf from unconfined_u:object_r:etc_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>

<span class="go">WARNING: Configure your firewall to allow the KK-Cryptoservice service.</span>

<span class="go">Configuration file has been written successfully to /etc/kriptakey/kk-csd.conf.</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Sample output if SNMP server has been configured.</span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>/opt/kriptakey/kk-cryptoservice/kk-cs.sh

<span class="go">KK-Manager instance host address []: 192.168.0.10</span>
<span class="go">KK-Manager instance port []: 8086</span>
<span class="go">KK-Cryptoservice port for REST API endpoint [7003]: 8087</span>
<span class="go">KK-Cryptoservice port for SDK API endpoint [7004]: 8088</span>
<span class="go">SNMP server host and port in xxx.xxx.xxx.xxx:xxxx format []: 192.168.0.5:1337</span>
<span class="go">SNMP username []: klavis</span>
<span class="go">SNMP authentication passphrase []: klavisauth</span>
<span class="go">SNMP privacy passphrase []: klavisencrypt</span>
<span class="go">KK-Cryptoservice log level (Option: ERROR/INFO/DEBUG) [ERROR]: ERROR</span>
<span class="go">KK-Cryptoservice working directory path [/var/local/kriptakey/kk-cryptoservice]: /var/local/kriptakey/kk-cryptoservice</span>

<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/db from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/sgxdata from unconfined_u:object_r:var_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>
<span class="go">Relabeled /etc/kriptakey/kk-csd.conf from unconfined_u:object_r:etc_t:s0 to system_u:object_r:kk_csd_var_t:s0</span>

<span class="go">WARNING: Configure your firewall to allow the KK-Cryptoservice service.</span>
<span class="go">Configuration file has been written successfully to /etc/kriptakey/kk-csd.conf.</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To unset the SNMP configuration, omit the SNMP destination when prompted by the script.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The configuration file for KK-Cryptoservice is stored in <code class="docutils literal notranslate"><span class="pre">/etc/kriptakey/kk-csd.conf</span></code>. Do not move
or remove the file to ensure the smooth operation of the service.</p>
</div>
</li>
<li><p>If you choose to enable SNMP, there is an additional step.
Kripta Key appliance is accompanied by script that will send crucial system information (CPU, Memory and
Disk utilization) using SNMP if SNMP is configured. The script will automatically send SNMP message every minute.
To enable this script, execute command below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>/opt/kriptakey/kk-sys_snmp.sh<span class="w"> </span>install
</pre></div>
</div>
</li>
<li><p>Install and enable firewall using <code class="docutils literal notranslate"><span class="pre">firewalld</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>firewalld

<span class="go">Last metadata expiration check: 3:36:25 ago on Mon 24 Jul 2023 11:22:58 AM CST.</span>
<span class="go">Package firewalld-0.9.3-13.0.1.al8.noarch is already installed.</span>
<span class="go">Dependencies resolved.</span>
<span class="go">Nothing to do.</span>
<span class="go">Complete!</span>

<span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>firewalld<span class="w"> </span>--now

<span class="go">Created symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service → /usr/lib/systemd/system/firewalld.service.</span>
<span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/firewalld.service → /usr/lib/systemd/system/firewalld.service.</span>
</pre></div>
</div>
</li>
<li><p>Reload the firewall service and set the zone as shown below. You can set the zone to public or private.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>kk-csd

<span class="go">success</span>

<span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload

<span class="go">success</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="registering-the-kk-cryptoservice-instance">
<h2>Registering the KK-Cryptoservice instance<a class="headerlink" href="#registering-the-kk-cryptoservice-instance" title="Link to this heading"></a></h2>
<p>Once the KK-Cryptoservice instance is set up, the administrator may proceed with registering it
to the KK-Manager instance.</p>
<ol class="arabic">
<li><p>Get the machine platform information. The output file will stored in the <code class="docutils literal notranslate"><span class="pre">sgxdata</span></code> directory.
On the ECS instance, run the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>-u<span class="w"> </span>kripta<span class="w"> </span>kk-csd<span class="w"> </span>--get-pck-id

<span class="go">Platform information has been written successfully to /var/local/kriptakey/kk-cryptoservice/sgxdata/8F0FFCDCXXXXXXXXXXXXXXXXXXXXXXXX.json.</span>
</pre></div>
</div>
<p>Copy the platform information to the machine that has CLIKK installed on it. The machine platform information
will be used to request the platform collateral from Intel.</p>
</li>
<li><p>Request the platform collateral from Intel. On the machine with CLIKK on it, run the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clikk<span class="w"> </span>conf<span class="w"> </span>get-collateral<span class="w"> </span>--intel-api-key<span class="o">=</span>39949131XXXXXXXXXXXXXXXXXXXXXXX<span class="w"> </span>--platform-info-path<span class="o">=</span>/home/user/documents/8F0FFCDCXXXXXXXXXXXXXXXXXXXXXXXX.json<span class="w"> </span>--output-dir-path<span class="o">=</span>/home/user/documents

<span class="go">This will fetch attestation material from Intel&#39;s trusted web service:</span>
<span class="go">    https://api.trustedservices.intel.com/sgx/certification/v4</span>
<span class="go">Type `:.rzv` to continue, or press Enter to cancel.</span>
<span class="go">&gt; :.rzv</span>

<span class="go">PCK certificate has been saved successfully to /home/user/documents/pck_cert_0323BC80XXXXXXXXXXXXXXXXXXXXXXXX.pem.</span>
<span class="go">Quote collateral has been saved successfully to /home/user/documents/collateral_00906EXXXXXX.json.</span>
</pre></div>
</div>
<p>To get the Intel API key, check <a class="reference internal" href="../appendix.html#obtaining-intel-api-key"><span class="std std-ref">Obtaining Intel API key</span></a> in the appendix.</p>
<p>Copy the PCK certificate and collateral to the ECS instance, and then from within the ECS instance, copy it
to the <code class="docutils literal notranslate"><span class="pre">sgxdata</span></code> directory within the working directory. Also, copy the latest backup from the KK-Manager instance
to the KK-Cryptoservice instance as well.</p>
</li>
<li><p>Run KK-Cryptoservice in registration mode on the ECS instance. Make sure that the latest backup is present.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>-u<span class="w"> </span>kripta<span class="w"> </span>kk-csd<span class="w"> </span>--kk-cryptoservice-pck-cert<span class="o">=</span>/var/local/kriptakey/kk-c/sgxdata/pck_cert_8F0FFCDCXXXXXXXXXXXXXXXXXXXXXXXX.pem<span class="w"> </span>--database-backup-path<span class="o">=</span>/path-to-backup-file/backup.db

<span class="go">Commencing the KK-Cryptoservice registration process.</span>
<span class="go">This will initialize a KK-Cryptoservice instance on this machine and register it to the KK-Manager instance.</span>
<span class="go">Any existing KK-Cryptoservice database file will be OVERWRITTEN.</span>
<span class="go">Do not interrupt the process until the message &quot;KK-Cryptoservice has been registered successfully to KK-Manager.&quot;.</span>
<span class="go">Are you sure you want to continue? Type `&#39;Q\y2` to continue, or press Enter to cancel.</span>
<span class="go">&gt; &#39;Q\y2</span>

<span class="go">[-] Ready for initialization and registration.</span>
<span class="go">[-] Listening on port 8086...</span>
<span class="go">[-] Waiting for connection from KK-Manager...</span>
</pre></div>
</div>
</li>
<li><p>Register the KK-Cryptoservice using CLIKK with the collateral obtained above. Make sure to use the host
IP address obtained while setting up the VPN.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clikk<span class="w"> </span>kk-cryptoservice<span class="w"> </span>add<span class="w"> </span>--kk-manager-collateral-path<span class="o">=</span>/home/user/documents/collateral_00A065XXXXXX.json<span class="w"> </span>--kk-cryptoservice-collateral-path<span class="o">=</span>/home/user/documents/collateral_00A065XXXXXX.json<span class="w"> </span>--kk-cryptoservice-host<span class="o">=</span><span class="m">192</span>.168.0.6<span class="w"> </span>--kk-cryptoservice-port<span class="o">=</span><span class="m">8086</span><span class="w"> </span>--kk-cryptoservice-name<span class="o">=</span>KK-CSOne

<span class="go">Enter admin ID: Admin1</span>
<span class="go">Enter password:</span>
<span class="go">Insert the administrator card of Admin1 for two-factor authentication.</span>

<span class="go">Dual control authentication -- credential of second user is required.</span>
<span class="go">Admin1 is currently logged in.</span>

<span class="go">Enter admin ID: Admin2</span>
<span class="go">Enter password:</span>
<span class="go">Insert the administrator card of Admin2 for two-factor authentication.</span>

<span class="go">KK-Cryptoservice `KK-CSOne` at 192.168.0.6 has been registered successfully.</span>
</pre></div>
</div>
<p>The KK-Cryptoservice instance will show this message after registration is complete.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[v] KK-Cryptoservice has been registered successfully to KK-Manager.</span>
</pre></div>
</div>
</li>
<li><p>Enable and run the KK-Cryptoservice service on the ECS instance. Ensure that the service is running successfully.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>kk-csd.service<span class="w"> </span>--now
<span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>kk-csd.service
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="before-installing.html" class="btn btn-neutral float-left" title="Before installing on cloud" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="misc-actions.html" class="btn btn-neutral float-right" title="Miscellaneous operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, PT Klavis Kripta Inovasi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>