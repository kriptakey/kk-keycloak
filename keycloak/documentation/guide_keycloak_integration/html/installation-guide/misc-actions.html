<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miscellaneous operations &mdash; Kripta Key Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b20cc3f5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=03d93ebb"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CLIKK Installation Guide" href="../clikk-installation-guide/index.html" />
    <link rel="prev" title="Appliance model" href="appliance-deployment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Kripta Key Documentation
          </a>
              <div class="version">
                24.1.0015-RC-UP02
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../revision-history.html">Revision History</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kripta-key-primer.html">Kripta Key Primer</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installation Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#preface">Preface</a></li>
<li class="toctree-l2"><a class="reference internal" href="before-installing.html">Before deploying Kripta Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="kripta-key-installation.html">Installing Kripta Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="cryptographic-service-installation.html">KK-Cryptoservice setup and configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="disaster-recovery.html">Disaster recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="appliance-deployment.html">Appliance model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Miscellaneous operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#version-checking">Version checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-kk-manager-backup">Automatic KK-Manager backup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exporting-kripta-key-backup-to-remote-machine">Exporting Kripta Key Backup To Remote Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resetting-recovery-cards">Resetting recovery cards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uninstalling-kripta-key-components">Uninstalling Kripta Key components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kripta-key-update">Kripta Key Update</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../clikk-installation-guide/index.html">CLIKK Installation Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cloud-installation-guide/index.html">Cloud Installation Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kkts-guide/index.html">KK-TS Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tdp-installation-guide/index.html">TDP Installation Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license-guide/index.html">License Application Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sys-admin-guide/index.html">System Administrator Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev-guide/index.html">Developer Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../e2ee-dev-guide/index.html">E2EE Developer Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../func-module-guide/index.html">Functional Module Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../app-integration-guide/index.html">App Integration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../keycloak-integration-guide/index.html">KeyCloak Integration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sdk-api-docs/index.html">SDK API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rest-api-docs/index.html">REST API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../whitepaper/index.html">Whitepaper</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kripta Key Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Installation Guide</a></li>
      <li class="breadcrumb-item active">Miscellaneous operations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/installation-guide/misc-actions.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="miscellaneous-operations">
<h1>Miscellaneous operations<a class="headerlink" href="#miscellaneous-operations" title="Link to this heading"></a></h1>
<section id="version-checking">
<h2>Version checking<a class="headerlink" href="#version-checking" title="Link to this heading"></a></h2>
<p>Kripta Key requires that all modules in operation within a deployment be of the same major
and minor version. Each module’s executable provides a command to check its version,
which are listed below:</p>
<ul>
<li><p>CLIKK</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clikk<span class="w"> </span>conf<span class="w"> </span>version
</pre></div>
</div>
</li>
<li><p>KK-Auditor</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>-u<span class="w"> </span>kripta<span class="w"> </span>kk-ad<span class="w"> </span>--version
</pre></div>
</div>
</li>
<li><p>KK-Manager</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>-u<span class="w"> </span>kripta<span class="w"> </span>kk-md<span class="w"> </span>--version
</pre></div>
</div>
</li>
<li><p>KK-Cryptoservice</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>-u<span class="w"> </span>kripta<span class="w"> </span>kk-csd<span class="w"> </span>--version
</pre></div>
</div>
</li>
</ul>
</section>
<section id="automatic-kk-manager-backup">
<h2>Automatic KK-Manager backup<a class="headerlink" href="#automatic-kk-manager-backup" title="Link to this heading"></a></h2>
<p>Any <a class="reference internal" href="../appendix.html#term-CUD"><span class="xref std std-term">CUD</span></a> command executed via CLIKK triggers KK-Manager to automatically create a database backup.
The backups are saved to the <code class="docutils literal notranslate"><span class="pre">backup</span></code> directory within KK-Manager’s working directory. Administrators are advised
to regularly (and preferably automatically) export the backups, to be stored outside of the KK-Manager machine.</p>
</section>
<section id="exporting-kripta-key-backup-to-remote-machine">
<h2>Exporting Kripta Key Backup To Remote Machine<a class="headerlink" href="#exporting-kripta-key-backup-to-remote-machine" title="Link to this heading"></a></h2>
<p>Here is a recommendation for automatically exporting backups. The backup will be copied to a remote machine, utilizing
<code class="docutils literal notranslate"><span class="pre">rsync</span></code> and <code class="docutils literal notranslate"><span class="pre">ssh</span></code> for the process.</p>
<ol class="arabic">
<li><p>Initially set up a backup machine to receive the Kripta Key backup database. This machine should run Linux and have
the SSH service installed. Execute the command below to ensure the service is enabled.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sshd
</pre></div>
</div>
</li>
<li><p>Check that SSH service is already running.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>list-units<span class="w"> </span>sshd*
<span class="go">UNIT               LOAD   ACTIVE SUB     DESCRIPTION</span>
<span class="go">sshd.service       loaded active running OpenSSH server daemon</span>
</pre></div>
</div>
</li>
<li><p>Allow the firewall to accept SSH connections on the backup machine.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-port<span class="o">=</span><span class="m">22</span>/tcp
<span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</pre></div>
</div>
</li>
<li><p>Then, login to Kripta Key machine and generate a new SSH key pair
(assign a specific name to the key pair, such as <code class="docutils literal notranslate"><span class="pre">id_klavis</span></code>), leaving the passphrase empty.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;KriptaKey&quot;</span><span class="w"> </span>-f<span class="w"> </span>~/.ssh/id_klavis
<span class="go">Generating public/private ed25519 key pair.</span>
<span class="go">Enter passphrase (empty for no passphrase):</span>
<span class="go">Enter same passphrase again:</span>
<span class="go">Your identification has been saved in /home/klavis/.ssh/id_klavis</span>
<span class="go">Your public key has been saved in /home/klavis/.ssh/id_klavis.pub</span>
<span class="go">The key fingerprint is:</span>
<span class="go">SHA256:VhxfeMwmcmOuAfoji95k1JHlPuJkgR7EAyjwKIwur3E KriptaKey</span>
<span class="go">The key&#39;s randomart image is:</span>
<span class="go">+--[ED25519 256]--+</span>
<span class="go">|o  ..o.   o  +.  |</span>
<span class="go">|+o.  .o..=.o*.=  |</span>
<span class="go">|+o.   oo+.+=.=   |</span>
<span class="go">|o    ..o =. .    |</span>
<span class="go">|..    o.S oo     |</span>
<span class="go">|..   ..=o...     |</span>
<span class="go">|. E  .oo..       |</span>
<span class="go">| +  .+.          |</span>
<span class="go">|.  .. .          |</span>
<span class="go">+----[SHA256]-----+</span>
</pre></div>
</div>
</li>
<li><p>Transfer the generated SSH key pair from the Kripta Key machine to the backup machine. Execute the following command
on the Kripta Key machine, replacing USERNAME and BACKUP_MACHINE_IP with the appropriate username and IP address of
the backup machine.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>id_klavis<span class="w"> </span>&lt;USERNAME@BACKUP_MACHINE_IP&gt;

<span class="gp">$ </span><span class="c1">## for example</span>
<span class="gp">$ </span>ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_klavis<span class="w"> </span>&lt;USERNAME@BACKUP_MACHINE_IP&gt;
<span class="go">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/home/klavis/.ssh/id_klavis.pub&quot;</span>
<span class="go">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span>
<span class="go">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span>
<span class="go">klavis@192.168.1.88&#39;s password:</span>

<span class="go">Number of key(s) added: 1</span>

<span class="go">Now try logging into the machine, with:   &quot;ssh &#39;USERNAME@BACKUP_MACHINE_IP&#39;&quot;</span>
<span class="go">and check to make sure that only the key(s) you wanted were added.</span>
</pre></div>
</div>
</li>
<li><p>Add a new SSH configuration file or edit it if it already exists (~/.ssh/config) on the Kripta Key machine. Populate it
with the following information.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Host dbbackup</span>
<span class="go">HostName BACKUP_MACHINE_IP</span>
<span class="go">User USERNAME</span>
<span class="go">IdentityFile ~/.ssh/id_klavis</span>
</pre></div>
</div>
</li>
<li><p>While still on the Kripta Key machine, invoke <code class="docutils literal notranslate"><span class="pre">rsync</span></code> in dry-run mode to test if it can transfer files to the backup machine.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rsync<span class="w"> </span>-navze<span class="w"> </span>ssh<span class="w"> </span>/var/local/kriptakey/kk-manager/backup/<span class="w"> </span>dbbackup:/tmp/klavis
<span class="go">sending incremental file list</span>
<span class="go">created directory /tmp/klavis</span>
<span class="go">./</span>
<span class="go">kkm-20241121-14:55:46.backup</span>
<span class="go">kkm-20241121-14:55:46.backup.log</span>
<span class="go">kkm-20241121-14:56:09.backup</span>
<span class="go">kkm-20241121-14:56:09.backup.log</span>
<span class="go">kkm-20241121-14:56:30.backup</span>
<span class="go">kkm-20241121-14:56:30.backup.log</span>
<span class="go">kkm-20241121-15:46:16-manual.backup</span>
<span class="go">kkm-20241121-15:52:51-manual.backup</span>
<span class="go">kkm-20241121-16:11:25.backup</span>
<span class="go">kkm-20241121-16:11:25.backup.log</span>
<span class="go">kkm-20241121-16:34:31.backup</span>
<span class="go">kkm-20241121-16:34:31.backup.log</span>
<span class="go">kkm-20241121-17:01:56.backup</span>
<span class="go">kkm-20241121-17:01:56.backup.log</span>
<span class="go">kkm-20241121-17:02:50.backup</span>
<span class="go">kkm-20241121-17:02:50.backup.log</span>
<span class="go">kkm-20241121-17:18:22.backup</span>
<span class="go">kkm-20241121-17:18:22.backup.log</span>
<span class="go">kkm-20241121-17:19:12.backup</span>
<span class="go">kkm-20241121-17:19:12.backup.log</span>
<span class="go">kkm-20241121-17:20:15.backup</span>
<span class="go">kkm-20241121-17:20:15.backup.log</span>
<span class="go">kkm-20241203-19:45:58.backup</span>
<span class="go">kkm-20241203-19:45:58.backup.log</span>
<span class="go">kkm-20241203-19:49:04.backup</span>
<span class="go">kkm-20241203-19:49:04.backup.log</span>
<span class="go">kkm-20241212-17:33:52.backup</span>
<span class="go">kkm-20241212-17:33:52.backup.log</span>
<span class="go">kkm-20241212-18:02:27.backup</span>
<span class="go">kkm-20241212-18:02:27.backup.log</span>
<span class="go">kkm-20241212-18:02:55.backup</span>
<span class="go">kkm-20241212-18:02:55.backup.log</span>
<span class="go">kkm-20241212-18:02:58.backup</span>
<span class="go">kkm-20241212-18:02:58.backup.log</span>
<span class="go">kkm-20241212-18:05:42.backup</span>
<span class="go">kkm-20241212-18:05:42.backup.log</span>
<span class="go">kkm-20241212-18:06:05.backup</span>
<span class="go">kkm-20241212-18:06:05.backup.log</span>
<span class="go">kkm-20241212-18:06:47.backup</span>
<span class="go">kkm-20241212-18:06:47.backup.log</span>
<span class="go">kkm-20241212-18:07:03.backup</span>
<span class="go">kkm-20241212-18:07:03.backup.log</span>
<span class="go">kkm-20241212-18:41:50.backup</span>
<span class="go">kkm-20241212-18:41:50.backup.log</span>
<span class="go">kkm-20241212-18:42:29.backup</span>
<span class="go">kkm-20241212-18:42:29.backup.log</span>
<span class="go">kkm-20241213-11:13:42.backup</span>
<span class="go">kkm-20241213-11:13:42.backup.log</span>
<span class="go">kkm-20241213-16:49:28.backup</span>
<span class="go">kkm-20241213-16:49:28.backup.log</span>
<span class="go">kkm-20241213-16:50:02.backup</span>
<span class="go">kkm-20241213-16:50:02.backup.log</span>

<span class="go">sent 1.59K bytes  received 209 bytes  3.60K bytes/sec</span>
<span class="go">total size is 5.82M  speedup is 3,236.74 (DRY RUN)</span>
</pre></div>
</div>
</li>
<li><p>Create a new cronjob to automate the backup process. Execute the following command on the Kripta Key machine to edit the cronjob.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>crontab<span class="w"> </span>-e
</pre></div>
</div>
</li>
<li><p>Insert this entry into the cronjob to run the backup at midnight daily.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">0 0 * * * rsync -aze ssh /var/local/kriptakey/kk-manager/backup/ dbbackup:/home/klavis/kkmbackup &gt;/dev/null 2&gt;&amp;1</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="resetting-recovery-cards">
<h2>Resetting recovery cards<a class="headerlink" href="#resetting-recovery-cards" title="Link to this heading"></a></h2>
<p>During emergencies, it may become necessary to perform certain highly privileged actions. Authenticating these actions
requires the recovery cards. Two sets of recovery cards are provisioned during key ceremony, which must be kept safely
and securely by each participant.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is highly recommended to regularly run the command <code class="docutils literal notranslate"><span class="pre">clikk</span> <span class="pre">kk-manager</span> <span class="pre">verify-recovery-cards</span></code> to ensure
the integrity of the recovery cards.</p>
</div>
<p>In the event that any of the recovery cards become corrupted and unusable, it is possible to reset the recovery cards.
Administrators must then regenerate the backup key on the recovery cards. Before proceeding with resetting
the recovery cards, prepare the deployment ID, the secure channel code (SCC), and both sets of the recovery cards.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Regenerating the backup key MUST be done immediately after resetting the recovery cards. Delaying the backup key
regeneration runs the risk of lacking a sufficient amount of recovery cards during emergency procedures, which
may lead to irrecoverable data loss.</p>
</div>
<p>The following command resets the recovery cards:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>-u<span class="w"> </span>kripta<span class="w"> </span>kk-md<span class="w"> </span>--reset-recovery-card

<span class="go">Enter the deployment ID, e.g., ENTERPRISE017048</span>
<span class="go">Deployment ID: 617106PRXXXXXXXXX</span>
<span class="go">Enter the secure channel code (SCC), e.g., 418464cad2908e49242cefb1b471612b</span>
<span class="go">Secure channel code: d68ed587XXXXXXXXXXXXXXXXXXXXXXXX</span>

<span class="go">Please insert the card to be reset into the card reader. Continue [y/N]? y</span>
<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Card number 1 has been successfully reset.</span>
<span class="go">Please insert the card to be reset into the card reader. Continue [y/N]? y</span>
<span class="go">Key in the PIN and press Enter on the PIN pad to read the SCKEKs.</span>
<span class="go">Card number 2 has been successfully reset.</span>
<span class="go">Please insert the card to be reset into the card reader. Continue [y/N]? y</span>
<span class="go">Key in the PIN and press Enter on the PIN pad to read the SCKEKs.</span>
<span class="go">Card number 3 has been successfully reset.</span>
<span class="go">Please insert the card to be reset into the card reader. Continue [y/N]? y</span>
<span class="go">Key in the PIN and press Enter on the PIN pad to read the SCKEKs.</span>
<span class="go">Card number 4 has been successfully reset.</span>
<span class="go">Please insert the card to be reset into the card reader. Continue [y/N]? n</span>
<span class="go">Stopped.</span>

<span class="go">A total of 4 cards have been reset successfully and can be reused to store new secrets.</span>
</pre></div>
</div>
<p>The following command regenerates the backup key:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clikk<span class="w"> </span>kk-manager<span class="w"> </span>regenerate-backup-key

<span class="go">This will regenerate the backup key and the recovery cards.</span>
<span class="go">Recovery cards associated with the previous backup key will become UNUSEABLE.</span>
<span class="go">Existing recovery cards may be used for this purpose.</span>
<span class="go">Prepare two sets of 5 cards each.</span>

<span class="go">Are you sure you want to continue? Type `DSIcE` to continue, or press Enter to cancel.</span>
<span class="go">&gt; DSIcE</span>

<span class="go">Enter the secure channel code (SCC): b2baa436XXXXXXXXXXXXXXXXXXXXXXXX</span>
<span class="go">Enter the deployment ID: ENTERPRIXXXXXXXX</span>
<span class="go">Dual control authentication--credential of a second administrator is required.</span>
<span class="go">admin1 is currently logged in.</span>

<span class="go">Enter admin ID: admin2</span>
<span class="go">Enter password:</span>

<span class="go">Insert the administrator card of admin2 for two-factor authentication.</span>
<span class="go">Remove the card!</span>

<span class="go">Please prepare 5 cards for the first set of recovery cards.</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 1 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 2 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 3 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 4 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 5 has been written successfully.</span>
<span class="go">Remove the card!</span>

<span class="go">Please prepare 5 cards for the second set of recovery cards.</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 1 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 2 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 3 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 4 has been written successfully.</span>
<span class="go">Remove the card!</span>
<span class="go">Insert a card!</span>

<span class="go">Key in the PIN and press Enter on the PIN pad to read the secure channel key encryption keys (SCKEKs).</span>
<span class="go">Secret 5 has been written successfully.</span>
<span class="go">Remove the card!</span>

<span class="go">Backup key has been regenerated successfully.</span>
<span class="go">It is strongly advised to test the regenerated recovery cards by running the `clikk kk-manager verify-recovery-cards` command.</span>
</pre></div>
</div>
</section>
<section id="uninstalling-kripta-key-components">
<h2>Uninstalling Kripta Key components<a class="headerlink" href="#uninstalling-kripta-key-components" title="Link to this heading"></a></h2>
<p>The process of uninstalling each Kripta Key component is similar for all components. The following steps demonstrate
how to uninstall KK-Cryptoservice. Adjust the commands accordingly for other components.</p>
<ol class="arabic">
<li><p>Uninstall using the RPM package.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>remove<span class="w"> </span>kk-cs-24.1.0007.el8.x86_64.rpm
</pre></div>
</div>
</li>
<li><p>Run post-uninstall script to clean up the SELinux policy.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>/opt/kriptakey/kk-cs_postun.sh

<span class="go">Relabeled /etc/kriptakey/kk-csd.conf from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:etc_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/db from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/db/kk-csd.db from unconfined_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/sgxdata from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/sgxdata/pck_cert_42ACCC9FD3DFA721ADBCE60F89DE623D.pem from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/sgxdata/collateral_00A065310000.json from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/sgxdata/42ACCC9FD3DFA721ADBCE60F89DE623D.json from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount/42ACCC9FD3DFA721ADBCE60F89DE623D_202310 from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount/42ACCC9FD3DFA721ADBCE60F89DE623D_202310/TransactionCount-42ACCC9FD3DFA721ADBCE60F89DE623D-20231030.csv from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount/42ACCC9FD3DFA721ADBCE60F89DE623D_202311 from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount/42ACCC9FD3DFA721ADBCE60F89DE623D_202311/TransactionCount-42ACCC9FD3DFA721ADBCE60F89DE623D-20231102.csv from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/txncount/42ACCC9FD3DFA721ADBCE60F89DE623D_202311/TransactionCount-42ACCC9FD3DFA721ADBCE60F89DE623D-20231101.csv from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/.kk-csd.lck from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231031_1.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231101_3.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231101_1.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231101_2.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231031.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231030.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">Relabeled /var/local/kriptakey/kk-cryptoservice/backup/kk-csd.db.20231101.old from system_u:object_r:kk_csd_var_t:s0 to system_u:object_r:var_t:s0</span>
<span class="go">libsemanage.semanage_direct_remove_key: Removing last kk_csd module (no other kk_csd module exists at another priority).</span>
</pre></div>
</div>
</li>
<li><p>Remove the firewall rules.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-service<span class="o">=</span>kk-csd.service
</pre></div>
</div>
</li>
<li><p>Optionally, remove the log files and the working directory. The log files can be found in <code class="docutils literal notranslate"><span class="pre">/var/log/kriptakey</span></code>.
The working directory is configurable, but the default is <code class="docutils literal notranslate"><span class="pre">/var/local/kriptakey</span></code>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p>For KK-Manager, the commands are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>remove<span class="w"> </span>kk-m-24.1.0007.el8.x86_64.rpm

<span class="gp">$ </span>sudo<span class="w"> </span>/opt/kriptakey/kk-m_postun.sh

<span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-service<span class="o">=</span>kk-md.service
</pre></div>
</div>
</li>
<li><p>For KK-Manager-DR, the commands are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>remove<span class="w"> </span>kk-m-24.1.0007.el8.x86_64.rpm

<span class="gp">$ </span>sudo<span class="w"> </span>/opt/kriptakey/kk-m_postun.sh

<span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-service<span class="o">=</span>kk-md-dr.service
</pre></div>
</div>
</li>
<li><p>For KK-Auditor, the commands are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>dnf<span class="w"> </span>remove<span class="w"> </span>kk-a-24.1.0007.el8.x86_64.rpm

<span class="gp">$ </span>sudo<span class="w"> </span>/opt/kriptakey/kk-a_postun.sh

<span class="gp">$ </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-service<span class="o">=</span>kk-ad.service
</pre></div>
</div>
</li>
</ul>
</div>
</section>
<section id="kripta-key-update">
<h2>Kripta Key Update<a class="headerlink" href="#kripta-key-update" title="Link to this heading"></a></h2>
<p>Kripta Key is released with version 24.1.0007-GA. It will update periodically for the hot fix and update pack version.</p>
<ol class="arabic simple">
<li><p>Hot fix
Hot fix (HF) version is the solution for the showstopper bug. It will be released as soon as the showstopper bug is
found. Hot Fix for the specific major and minor version is numbered based on the release order.</p></li>
<li><p>Update Pack
Update Pack (UP) version is the solution for non-showstopper bug. It will be released periodically. Update Pack for
the specific major and minor version is numbered based on the release order.</p></li>
</ol>
<p>To get the hot fix and update pack version, you can update the existing version you have to the hot fix or update pack with
updater tool that we provide. Run command below on the specific module machine and ensure you pass the updated rpm file.</p>
<ul>
<li><p>KK-Auditor</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>./kk-updatertool<span class="w"> </span>--kka-updater-file-path<span class="o">=</span>/pathToUpdatedkkarpm/

<span class="go">[-] Installed package name: kk-a</span>
<span class="go">[-] Installed package version: 24.1.0007.el8</span>
<span class="go">[-] Updater package name: kk-a</span>
<span class="go">[-] Updater package version: 24.1.0008.el8</span>
<span class="go">[-] Updating kk-a package ...</span>
<span class="go">[v] kk-a successfully updated to 24.1.0008.el8!</span>
</pre></div>
</div>
</li>
<li><p>KK-Manager</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>./kk-updatertool<span class="w"> </span>--kkm-updater-file-path<span class="o">=</span>/pathToUpdatedkkmrpm/

<span class="go">[-] Installed package name: kk-m</span>
<span class="go">[-] Installed package version: 24.1.0007.el8</span>
<span class="go">[-] Updater package name: kk-m</span>
<span class="go">[-] Updater package version: 24.1.0008.el8</span>
<span class="go">[-] Updating kk-m package ...</span>
<span class="go">[v] kk-a successfully updated to 24.1.0008.el8!</span>
</pre></div>
</div>
</li>
<li><p>KK-Cryptoservice</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>./kk-updatertool<span class="w"> </span>--kkcs-updater-file-path<span class="o">=</span>/pathToUpdatedkkcsrpm/

<span class="go">[-] Installed package name: kk-cs</span>
<span class="go">[-] Installed package version: 24.1.0007.el8</span>
<span class="go">[-] Updater package name: kk-cs</span>
<span class="go">[-] Updater package version: 24.1.0008.el8</span>
<span class="go">[-] Updating kk-cs package ...</span>
<span class="go">[v] kk-a successfully updated to 24.1.0008.el8!</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="appliance-deployment.html" class="btn btn-neutral float-left" title="Appliance model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../clikk-installation-guide/index.html" class="btn btn-neutral float-right" title="CLIKK Installation Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, PT Klavis Kripta Inovasi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>